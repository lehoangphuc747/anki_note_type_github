<!-- FRONT CARD 2 - REVIEW - NEW UI -->

<div class="card-container card-front">

  <!-- ==================================================
       ADMIN PHÚC FROM ANKIVN
       a.k.a TIẾNG HÀN PHÚC LEE
       TRÙM DẠY ANKI
       FB: https://www.facebook.com/tui.la.phuc747/
       ================================================== -->

  <main class="card-content">
    <!-- Từ vựng tiếng Hàn -->
    <div class="tuvung">{{edit:word}}</div>

    <!-- Word Info Row: Audio + IPA + Loại từ -->
    <div class="word-info-row">
      <div class="sound">{{audio_word}}</div>
      {{#transliteration}}
      <span class="ipa">/{{transliteration}}/</span>
      {{/transliteration}}
      {{#pos}}
      <span class="pos-badge">{{pos}}</span>
      {{/pos}}
    </div>

    <!-- Ví dụ (nếu có) -->
    {{#example}}
    <div class="example-box">
      <div class="ex-text">
        {{example}} <span class="ex-audio">{{audio_example}}</span>
      </div>
    </div>
    {{/example}}

    <!-- Hình ảnh -->
    {{#image}}
    <div class="image-cue-container">
      <div class="hinhanh">{{image}}</div>
    </div>
    {{/image}}

    <!-- TAGS -->
    <div class="card-tags">
      <span class="tag-badge">{{tag_1}}</span>
      <span class="tag-badge">{{tag_2}}</span>
      <span class="tag-badge">{{tag_3}}</span>
      <span class="tag-badge">{{tag_4}}</span>
    </div>
  </main>

</div>

<!-- NÚT CÀI ĐẶT -->
<button id="btnSettings" class="btn-settings" onclick="toggleSettings(event)">
  <svg viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
</button>

<!-- MENU CÀI ĐẶT -->
<div class="settings-menu" id="settingsMenu">
  <div class="menu-item">
    <span class="menu-label">Chế độ tối</span>
    <div class="toggle-switch" id="swNight" onclick="toggleConfig('nightMode')"></div>
  </div>
  <div class="menu-item">
    <span class="menu-label">Dịch ví dụ</span>
    <div class="toggle-switch checked" id="swTrans" onclick="toggleConfig('showTrans')"></div>
  </div>
  <div class="menu-item">
    <span class="menu-label">Ví dụ</span>
    <div class="toggle-switch checked" id="swExample" onclick="toggleConfig('showExample')"></div>
  </div>
  <div class="menu-item">
    <span class="menu-label">Giải thích</span>
    <div class="toggle-switch checked" id="swExplain" onclick="toggleConfig('showExplain')"></div>
  </div>
  <div class="menu-item">
    <span class="menu-label">Mở rộng</span>
    <div class="toggle-switch checked" id="swExpand" onclick="toggleConfig('autoExpand')"></div>
  </div>
  <div class="menu-item">
    <span class="menu-label">Hiện ảnh</span>
    <div class="toggle-switch checked" id="swImage" onclick="toggleConfig('showImage')"></div>
  </div>
  <div class="menu-item">
    <span class="menu-label">Hiện Tags</span>
    <div class="toggle-switch checked" id="swTags" onclick="toggleConfig('showTags')"></div>
  </div>
  <div class="menu-item">
    <span class="menu-label">Link FB (Footer)</span>
    <div class="toggle-switch checked" id="swFb" onclick="toggleConfig('showFb')"></div>
  </div>
  <a href="https://www.facebook.com/tui.la.phuc747/" class="menu-link">Ghé thăm FB Phúc Lee</a>
</div>

<script>
// --- CONFIGURATION & STATE MANAGEMENT ---
var defaultConfig = {
  nightMode: false,
  showTrans: true,
  showExample: true,
  showExplain: true,
  autoExpand: true,
  showImage: true,
  showTags: true,
  showFb: true
};

var config = {};

function loadConfig() {
  try {
    var stored = localStorage.getItem('anki-card-config');
    if (stored) {
      config = JSON.parse(stored);
      for (var key in defaultConfig) {
        if (config[key] === undefined) {
          config[key] = defaultConfig[key];
        }
      }
    } else {
      config = JSON.parse(JSON.stringify(defaultConfig));
      saveConfig();
    }
  } catch (e) {
    config = JSON.parse(JSON.stringify(defaultConfig));
  }
  applyConfig();
}

function saveConfig() {
  try {
    localStorage.setItem('anki-card-config', JSON.stringify(config));
  } catch (e) {}
}

function applyConfig() {
  document.body.classList.toggle('night-mode', config.nightMode);
  updateSwitch('swNight', config.nightMode);

  document.body.classList.toggle('hide-trans', !config.showTrans);
  updateSwitch('swTrans', config.showTrans);

  document.body.classList.toggle('hide-example', !config.showExample);
  updateSwitch('swExample', config.showExample);

  document.body.classList.toggle('hide-explain', !config.showExplain);
  updateSwitch('swExplain', config.showExplain);

  var details = document.getElementById('expandDetails');
  if(details) {
    if(config.autoExpand) details.setAttribute('open', '');
    else details.removeAttribute('open');
  }
  updateSwitch('swExpand', config.autoExpand);

  document.body.classList.toggle('hide-image', !config.showImage);
  updateSwitch('swImage', config.showImage);

  document.body.classList.toggle('hide-tags-card', !config.showTags);
  updateSwitch('swTags', config.showTags);

  document.body.classList.toggle('hide-fb', !config.showFb);
  updateSwitch('swFb', config.showFb);
}

function updateSwitch(id, isActive) {
  var el = document.getElementById(id);
  if(el) {
    if(isActive) el.classList.add('checked');
    else el.classList.remove('checked');
  }
}

function toggleConfig(key) {
  config[key] = !config[key];
  saveConfig();
  applyConfig();
}

function toggleSettings(e) {
  e.stopPropagation();
  document.getElementById('settingsMenu').classList.toggle('active');
}

document.addEventListener('click', function(e) {
  var menu = document.getElementById('settingsMenu');
  var btn = document.getElementById('btnSettings');
  if (menu && menu.classList.contains('active')) {
    if (!menu.contains(e.target) && btn && !btn.contains(e.target)) {
      menu.classList.remove('active');
    }
  }
});

document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    var menu = document.getElementById('settingsMenu');
    if(menu) menu.classList.remove('active');
  }
});

loadConfig();
</script>